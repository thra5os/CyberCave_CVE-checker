import os
import re
import subprocess
import pandas as pd

#to get the path of the powershell 
powershell_path = r'C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe'


#the command to get the list of application and their versions
powershell_command = r'Get-Package -ProviderName Programs,msi | Select-Object Name, Version | Export-Csv -Path apps.csv -NoTypeInformation'
#to actually execute the command
subprocess.call([powershell_path, "-Command", powershell_command], shell=True)

#use of pandas to remove all empty lines
apps = pd.read_csv('apps.csv')
apps = apps.dropna()

apps['Version'] = apps['Version'].apply(lambda x: re.findall(r'\b\d+(?:\.\d+)*\b', x))


list_of_apps = apps.to_dict(orient='records')
dict_of_apps = {}

for item in list_of_apps:
    name= item['Name']
    version = item['Version']
    dict_of_apps.update({name:version})


print(dict_of_apps)

#return dict_of_apps

#to delete the csv file :
#subprocess.call([powershell_path, "-Command", "rm apps.csv", shell=True)
